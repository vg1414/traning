<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√§ningslogg</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        :root {
            --bg: #0d1117;
            --surface: #161b22;
            --surface2: #21262d;
            --border: #30363d;
            --text: #e6edf3;
            --muted: #8b949e;
            --c-brost: #ff6b6b;
            --c-rygg: #4fc3f7;
            --c-axlar: #c084fc;
            --c-cardio: #4ade80;
            --c-ben: #fb923c;
            --c-helkropp: #facc15;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
        .screen { display: none; min-height: 100vh; }
        .screen.active { display: block; }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .top-bar {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .top-bar h1 { font-size: 18px; font-weight: 600; flex: 1; }
        .top-bar h1 span { color: var(--muted); font-weight: 400; }

        .btn-icon {
            background: none;
            border: 1px solid var(--border);
            color: var(--muted);
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 18px;
            line-height: 1;
            transition: all 0.15s;
        }
        .btn-icon:hover { background: var(--surface2); color: var(--text); }

        /* ‚îÄ‚îÄ HOME ‚îÄ‚îÄ */
        .home-body {
            max-width: 560px;
            margin: 0 auto;
            padding: 32px 20px 40px;
        }

        .home-greeting {
            text-align: center;
            margin-bottom: 28px;
        }
        .home-greeting h2 { font-size: 26px; font-weight: 700; margin-bottom: 4px; }
        .home-greeting p { color: var(--muted); font-size: 14px; }

        .workout-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-bottom: 24px;
        }

        .wcard {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 26px 16px 22px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .wcard::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: var(--accent);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .wcard:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
        .wcard:hover::before { opacity: 1; }
        .wcard:active { transform: translateY(0); }

        .wcard .icon { font-size: 38px; margin-bottom: 10px; display: block; }
        .wcard h3 { font-size: 14px; font-weight: 600; color: var(--accent); }
        .wcard .last-session { font-size: 11px; color: var(--muted); margin-top: 4px; }

        .wcard-brost { --accent: var(--c-brost); }
        .wcard-rygg  { --accent: var(--c-rygg); }
        .wcard-axlar { --accent: var(--c-axlar); }
        .wcard-cardio{ --accent: var(--c-cardio); }

        .history-btn {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 13px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .history-btn:hover { background: var(--surface2); color: var(--text); border-color: #58a6ff; }

        .programs-btn {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 13px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }
        .programs-btn:hover { background: var(--surface2); color: var(--text); border-color: #f59e0b; }

        /* ‚îÄ‚îÄ PROGRAMS SCREEN ‚îÄ‚îÄ */
        .programs-body {
            max-width: 560px;
            margin: 0 auto;
            padding: 20px 16px 40px;
        }
        .prog-section-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
            margin: 22px 0 10px;
        }
        .prog-section-label:first-child { margin-top: 0; }
        .prog-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px 14px 14px 18px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }
        .prog-card::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 4px;
            background: var(--pc);
        }
        .prog-card:hover {
            border-color: var(--pc);
            transform: translateX(3px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.35);
        }
        .prog-emoji { font-size: 30px; min-width: 42px; text-align: center; }
        .prog-info { flex: 1; min-width: 0; }
        .prog-name { font-size: 15px; font-weight: 700; margin-bottom: 2px; }
        .prog-sub { font-size: 12px; color: var(--muted); margin-bottom: 7px; }
        .prog-meta { display: flex; gap: 6px; flex-wrap: wrap; align-items: center; }
        .prog-tag {
            background: var(--surface2);
            border-radius: 4px;
            padding: 2px 7px;
            font-size: 11px;
            color: var(--muted);
        }
        .prog-tag-level {
            border-radius: 4px;
            padding: 2px 7px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid var(--pc);
            color: var(--pc);
        }
        .prog-arrow { color: var(--muted); font-size: 20px; flex-shrink: 0; }

        /* ‚îÄ‚îÄ EXERCISE SECTION HEADERS (f√∂r cirkelpass) ‚îÄ‚îÄ */
        .ex-section-head {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 22px 0 8px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
        }
        .ex-section-head::before, .ex-section-head::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }
        .ex-section-head:first-child { margin-top: 4px; }

        /* ‚îÄ‚îÄ EXERCISE IMAGE THUMBNAIL ‚îÄ‚îÄ */
        .ex-thumb {
            width: 78px;
            height: 56px;
            object-fit: cover;
            border-radius: 7px;
            cursor: pointer;
            opacity: 0.82;
            flex-shrink: 0;
            transition: opacity 0.15s, transform 0.15s;
            border: 1px solid var(--border);
        }
        .ex-thumb:hover { opacity: 1; transform: scale(1.06); }

        /* ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ */
        .lightbox {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.88);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            cursor: zoom-out;
        }
        .lightbox.open { display: flex; }
        .lightbox img {
            max-width: 94vw;
            max-height: 86vh;
            border-radius: 10px;
            object-fit: contain;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        }
        .lightbox-close {
            position: absolute;
            top: 16px; right: 20px;
            font-size: 28px;
            color: #fff;
            cursor: pointer;
            line-height: 1;
            opacity: 0.7;
        }
        .lightbox-close:hover { opacity: 1; }

        /* ‚îÄ‚îÄ WORKOUT ‚îÄ‚îÄ */
        .workout-body {
            max-width: 680px;
            margin: 0 auto;
            padding: 20px 16px 40px;
        }

        .session-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #000;
        }
        .session-date { font-size: 13px; color: var(--muted); }
        .prev-session-info { font-size: 12px; color: var(--muted); margin-left: auto; font-style: italic; }

        .ex-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 14px;
            overflow: hidden;
        }
        .ex-header {
            padding: 13px 16px;
            border-bottom: 1px solid var(--surface2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .ex-name { font-weight: 600; font-size: 15px; }

        .sets-table { width: 100%; border-collapse: collapse; }
        .sets-table thead tr { background: var(--bg); }
        .sets-table th {
            color: var(--muted);
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 14px;
            text-align: left;
        }
        .sets-table th:last-child { width: 40px; }

        .set-row td { padding: 7px 14px; border-bottom: 1px solid var(--surface2); }
        .set-row:last-child td { border-bottom: none; }
        .set-num { color: var(--muted); font-size: 13px; width: 32px; }

        .set-input {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 14px;
            width: 88px;
            transition: border-color 0.15s;
        }
        .set-input:focus { outline: none; border-color: #58a6ff; }

        .prev-val { font-size: 11px; color: var(--muted); margin-top: 2px; }

        .del-set {
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            font-size: 18px;
            padding: 2px 6px;
            border-radius: 4px;
            line-height: 1;
            transition: all 0.15s;
        }
        .del-set:hover { color: #f85149; background: rgba(248,81,73,0.1); }

        .add-set-btn {
            display: block;
            width: 100%;
            background: none;
            border: none;
            border-top: 1px dashed var(--border);
            color: #58a6ff;
            cursor: pointer;
            padding: 10px;
            font-size: 13px;
            transition: background 0.15s;
        }
        .add-set-btn:hover { background: var(--surface2); }

        .save-btn {
            width: 100%;
            background: #238636;
            border: none;
            color: #fff;
            padding: 14px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: background 0.2s;
        }
        .save-btn:hover { background: #2ea043; }
        .save-btn:active { background: #1a7f37; }

        /* ‚îÄ‚îÄ USER SELECT ‚îÄ‚îÄ */
        .user-select-body {
            max-width: 440px;
            margin: 0 auto;
            padding: 56px 24px 40px;
            text-align: center;
        }
        .user-select-body h2 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .user-select-body p  { color: var(--muted); font-size: 15px; margin-bottom: 44px; }

        .user-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        .user-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 18px;
            padding: 36px 16px 28px;
            cursor: pointer;
            text-align: center;
            transition: all 0.22s;
            position: relative;
            overflow: hidden;
        }
        .user-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: var(--uc);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .user-card:hover { border-color: var(--uc); transform: translateY(-4px); box-shadow: 0 12px 32px rgba(0,0,0,0.45); }
        .user-card:hover::before { opacity: 1; }
        .user-card:active { transform: translateY(0); }
        .u-avatar { font-size: 54px; display: block; margin-bottom: 14px; }
        .u-name { font-size: 22px; font-weight: 700; color: var(--uc); }
        .user-card-emma  { --uc: #f472b6; }
        .user-card-david { --uc: #38bdf8; }

        .switch-user-btn {
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            font-size: 13px;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.15s;
        }
        .switch-user-btn:hover { color: var(--text); background: var(--surface2); }

        /* ‚îÄ‚îÄ CARDIO ‚îÄ‚îÄ */
        .cardio-body {
            max-width: 480px;
            margin: 0 auto;
            padding: 24px 20px 40px;
        }
        .cardio-body h2 { font-size: 16px; font-weight: 600; color: var(--muted); margin-bottom: 14px; text-transform: uppercase; letter-spacing: 0.5px; }

        .activity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 28px;
        }
        .act-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px 10px 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .act-card:hover { border-color: var(--c-cardio); background: var(--surface2); }
        .act-card.selected { border-color: var(--c-cardio); background: rgba(74,222,128,0.08); }
        .act-card .icon { font-size: 30px; display: block; margin-bottom: 8px; }
        .act-card span { font-size: 13px; color: var(--muted); transition: color 0.2s; }
        .act-card.selected span { color: var(--c-cardio); font-weight: 600; }

        .form-row { margin-bottom: 18px; }
        .form-row label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; font-weight: 500; }
        .form-row input {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 8px;
            padding: 12px 14px;
            width: 100%;
            font-size: 16px;
            transition: border-color 0.15s;
        }
        .form-row input:focus { outline: none; border-color: var(--c-cardio); }

        .save-btn-cardio {
            background: #166534;
            border: none;
            color: #fff;
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: background 0.2s;
        }
        .save-btn-cardio:hover { background: #15803d; }

        /* ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ */
        .history-body {
            max-width: 640px;
            margin: 0 auto;
            padding: 20px 16px 40px;
        }
        .history-empty { text-align: center; color: var(--muted); padding: 60px 0; font-size: 15px; }

        .hist-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .hist-header {
            padding: 13px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }
        .hist-header.open { border-bottom-color: var(--surface2); }
        .hist-title { font-weight: 600; flex: 1; }
        .hist-date { font-size: 12px; color: var(--muted); }
        .hist-chevron { color: var(--muted); font-size: 12px; transition: transform 0.2s; }
        .hist-header.open .hist-chevron { transform: rotate(180deg); }

        .hist-body { display: none; padding: 14px 16px; }
        .hist-body.open { display: block; }

        .hist-ex { margin-bottom: 12px; }
        .hist-ex:last-child { margin-bottom: 0; }
        .hist-ex-name { font-size: 14px; font-weight: 600; margin-bottom: 6px; color: var(--muted); }
        .hist-sets { display: flex; gap: 8px; flex-wrap: wrap; }
        .hist-set-pill {
            background: var(--surface2);
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 13px;
        }

        .hist-cardio-info { font-size: 14px; color: var(--muted); }
        .hist-cardio-info strong { color: var(--text); }

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: #238636;
            color: #fff;
            padding: 11px 22px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s;
            z-index: 100;
            white-space: nowrap;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.error { background: #b91c1c; }

        /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
        @media (max-width: 440px) {
            .workout-grid { grid-template-columns: 1fr; }
            .activity-grid { grid-template-columns: 1fr 1fr 1fr; }
            .wcard { padding: 20px 12px 16px; }
        }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê USER SELECT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-user" class="screen active">
    <div class="top-bar">
        <h1>Tr√§ningslogg</h1>
    </div>
    <div class="user-select-body">
        <h2>Vem tr√§nar idag?</h2>
        <p>V√§lj din profil f√∂r att komma ig√•ng</p>
        <div class="user-grid">
            <div class="user-card user-card-emma" onclick="selectUser('Emma')">
                <span class="u-avatar">üë©</span>
                <div class="u-name">Emma</div>
            </div>
            <div class="user-card user-card-david" onclick="selectUser('David')">
                <span class="u-avatar">üë®</span>
                <div class="u-name">David</div>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-home" class="screen">
    <div class="top-bar">
        <h1>Tr√§ningslogg</h1>
        <button class="switch-user-btn" onclick="switchUser()" title="Byt anv√§ndare">‚áÑ Byt</button>
    </div>
    <div class="home-body">
        <div class="home-greeting">
            <h2 id="home-greeting-name"></h2>
            <p id="home-date"></p>
        </div>
        <div class="workout-grid">
            <div class="wcard wcard-brost" onclick="startWorkout('brost')">
                <span class="icon">üí™</span>
                <h3>Br√∂st & Triceps</h3>
                <div class="last-session" id="last-brost"></div>
            </div>
            <div class="wcard wcard-rygg" onclick="startWorkout('rygg')">
                <span class="icon">üèãÔ∏è</span>
                <h3>Rygg & Biceps</h3>
                <div class="last-session" id="last-rygg"></div>
            </div>
            <div class="wcard wcard-axlar" onclick="startWorkout('axlar')">
                <span class="icon">üîÜ</span>
                <h3>Axlar & Mage</h3>
                <div class="last-session" id="last-axlar"></div>
            </div>
            <div class="wcard wcard-cardio" onclick="startWorkout('cardio')">
                <span class="icon">üèÉ</span>
                <h3>Cardio</h3>
                <div class="last-session" id="last-cardio"></div>
            </div>
        </div>
        <button class="history-btn" onclick="showHistory()">üìã &nbsp; Visa tr√§ningshistorik</button>
        <button class="programs-btn" onclick="showPrograms()">‚≠ê &nbsp; F√§rdiga tr√§ningsprogram</button>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WORKOUT (STYRKA) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-workout" class="screen">
    <div class="top-bar">
        <button class="btn-icon" onclick="goHome()">‚Üê</button>
        <h1 id="workout-title"></h1>
    </div>
    <div class="workout-body">
        <div class="session-meta">
            <span class="badge" id="workout-badge"></span>
            <span class="session-date" id="workout-date"></span>
            <span class="prev-session-info" id="prev-session-info"></span>
        </div>
        <div id="exercises-list"></div>
        <button class="save-btn" onclick="saveWorkout()">Spara tr√§ningspass</button>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CARDIO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-cardio" class="screen">
    <div class="top-bar">
        <button class="btn-icon" onclick="goHome()">‚Üê</button>
        <h1>Cardio</h1>
    </div>
    <div class="cardio-body">
        <h2>V√§lj aktivitet</h2>
        <div class="activity-grid">
            <div class="act-card" onclick="selectActivity(this,'cykel')">
                <span class="icon">üö¥</span>
                <span>Cykel</span>
            </div>
            <div class="act-card" onclick="selectActivity(this,'promenad')">
                <span class="icon">üö∂</span>
                <span>Promenad</span>
            </div>
            <div class="act-card" onclick="selectActivity(this,'crosstrainer')">
                <span class="icon">üéø</span>
                <span>Crosstrainer</span>
            </div>
        </div>

        <div class="form-row">
            <label>Tid (minuter)</label>
            <input type="number" id="cardio-time" placeholder="45" min="1" inputmode="numeric">
        </div>
        <div class="form-row">
            <label>Kalorier (kcal)</label>
            <input type="number" id="cardio-kcal" placeholder="350" min="1" inputmode="numeric">
        </div>
        <button class="save-btn-cardio" onclick="saveCardio()">Spara Cardio</button>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRAMS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-programs" class="screen">
    <div class="top-bar">
        <button class="btn-icon" onclick="goHome()">‚Üê</button>
        <h1>F√§rdiga program</h1>
    </div>
    <div class="programs-body" id="programs-list"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-history" class="screen">
    <div class="top-bar">
        <button class="btn-icon" onclick="goHome()">‚Üê</button>
        <h1>Historik</h1>
    </div>
    <div class="history-body" id="history-list"></div>
</div>

<div class="toast" id="toast"></div>

<div class="lightbox" id="lightbox" onclick="closeLightbox()">
    <span class="lightbox-close">√ó</span>
    <img id="lightbox-img" src="" alt="">
</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const WORKOUTS = {
    brost: {
        title: 'Br√∂st & Triceps',
        color: '#ff6b6b',
        exercises: [
            'Lutande hantelpress',
            'Rak hantelpress',
            'B√§nkpress',
            'Drag curl',
            'Pushdowns',
            'Pec deck',
            'Br√∂stpress',
        ]
    },
    rygg: {
        title: 'Rygg & Biceps',
        color: '#4fc3f7',
        exercises: [
            'Marklyft',
            'Latsdrag',
            'Sittande rodd',
            'Hantelrodd',
            'Biceps curl (skivst√•ng)',
            'Hammer curl'
        ]
    },
    axlar: {
        title: 'Axlar & Mage',
        color: '#c084fc',
        exercises: [
            'Milit√§rpress',
            'Sidolyft',
            'Framlyft',
            'Face pull',
            'Plankan (sek)',
            'Sit-ups',
            'Ryska vridningar'
        ]
    },
    ben: { title: 'Ben & Rumpa', color: '#fb923c', exercises: [] },
    helkropp: { title: 'Helkropp', color: '#facc15', exercises: [] }
};

// ‚îÄ‚îÄ F√ÑRDIGA PROGRAM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PROGRAMS = [
    {
        id: 'push', title: 'Push-dag', subtitle: 'Br√∂st, Axlar & Triceps',
        emoji: 'üí™', color: '#ff6b6b', type: 'brost',
        level: 'Mellanniv√•', duration: '50‚Äì60 min', section: '√ñverkropp',
        exercises: [
            { name: 'B√§nkpress',            sets: 4, reps: 10 },
            { name: 'Lutande hantelpress',   sets: 3, reps: 12 },
            { name: 'Kabelkorsning',         sets: 3, reps: 15 },
            { name: 'Milit√§rpress',          sets: 3, reps: 10 },
            { name: 'Sidolyft',             sets: 4, reps: 15 },
            { name: 'Triceps pushdown',      sets: 3, reps: 15 },
        ]
    },
    {
        id: 'pull', title: 'Pull-dag', subtitle: 'Rygg & Biceps',
        emoji: 'üèãÔ∏è', color: '#4fc3f7', type: 'rygg',
        level: 'Mellanniv√•', duration: '50‚Äì60 min', section: '√ñverkropp',
        exercises: [
            { name: 'Latsdrag',               sets: 4, reps: 10 },
            { name: 'Sittande rodd',           sets: 4, reps: 10 },
            { name: 'Hantelrodd',              sets: 3, reps: 12 },
            { name: 'Face pull',               sets: 4, reps: 15 },
            { name: 'Biceps curl (skivst√•ng)', sets: 3, reps: 12 },
            { name: 'Hammer curl',             sets: 3, reps: 12 },
        ]
    },
    {
        id: 'axlar_core', title: 'Axlar & Core', subtitle: 'Breda axlar & stark mage',
        emoji: 'üî•', color: '#c084fc', type: 'axlar',
        level: 'Mellanniv√•', duration: '45‚Äì55 min', section: '√ñverkropp',
        exercises: [
            { name: 'Milit√§rpress',       sets: 4, reps: 10 },
            { name: 'Sidolyft',          sets: 4, reps: 15 },
            { name: 'Face pull',          sets: 3, reps: 20 },
            { name: 'Plankan (sek)',      sets: 4, reps: 45 },
            { name: 'Ryska vridningar',   sets: 3, reps: 20 },
            { name: 'Bicycle crunches',   sets: 3, reps: 25 },
        ]
    },
    {
        id: 'ben_volym', title: 'Ben & Rumpa ‚Äì Volym', subtitle: 'Form, pump och rumpa i fokus',
        emoji: 'üçë', color: '#fb923c', type: 'ben',
        level: 'Mellanniv√•', duration: '55‚Äì65 min', section: 'Underkropp',
        exercises: [
            { name: 'Kn√§b√∂j',                   sets: 4, reps: 10 },
            { name: 'H√∂ftlyft (hip thrust)',     sets: 4, reps: 12 },
            { name: 'Utfallssteg',               sets: 3, reps: 12 },
            { name: 'Rumpa kickback (kabel)',    sets: 3, reps: 15 },
            { name: 'H√∂ftabduktion (maskin)',    sets: 3, reps: 20 },
            { name: 'Calf raises',               sets: 4, reps: 20 },
        ]
    },
    {
        id: 'ben_styrka', title: 'Ben & Rumpa ‚Äì Styrka', subtitle: 'Tunga lyft f√∂r starka ben',
        emoji: 'ü¶µ', color: '#f59e0b', type: 'ben',
        level: 'Avancerad', duration: '55‚Äì65 min', section: 'Underkropp',
        exercises: [
            { name: 'Sumo marklyft',            sets: 4, reps: 6  },
            { name: 'Romanian deadlift',         sets: 4, reps: 8  },
            { name: 'H√∂ftlyft (hip thrust)',     sets: 4, reps: 10 },
            { name: 'Bulgarian split squat',     sets: 3, reps: 10 },
            { name: 'H√∂ftabduktion (maskin)',    sets: 3, reps: 15 },
            { name: 'Nordic curl',               sets: 3, reps: 8  },
        ]
    },
    {
        id: 'helkropp', title: 'Helkropp ‚Äì Effektivt', subtitle: 'Alla muskelgrupper p√• ett pass',
        emoji: '‚ö°', color: '#facc15', type: 'helkropp',
        level: 'Mellanniv√•', duration: '35‚Äì45 min', section: 'Helkropp',
        exercises: [
            { name: 'Kn√§b√∂j',        sets: 3, reps: 10 },
            { name: 'Marklyft',      sets: 3, reps: 8  },
            { name: 'B√§nkpress',     sets: 3, reps: 10 },
            { name: 'Latsdrag',      sets: 3, reps: 10 },
            { name: 'Milit√§rpress',  sets: 2, reps: 12 },
            { name: 'Plankan (sek)', sets: 3, reps: 45 },
        ]
    },
    {
        id: 'hiit', title: 'Cirkelfys ‚Äì Helkropp', subtitle: 'Uppv√§rmning ¬∑ 3 varv ¬∑ Nedvarvning',
        emoji: 'üîÑ', color: '#f43f5e', type: 'helkropp',
        level: 'Intensivt', duration: '45‚Äì55 min', section: 'Helkropp',
        exercises: [
            { name: 'Uppv√§rmning',                       isSection: true },
            { name: 'Hopphopp',                          sets: 2, reps: 40 },
            { name: 'High knees (sek)',                  sets: 2, reps: 30 },
            { name: 'Armcirklar',                        sets: 1, reps: 20 },
            { name: 'Dynamisk h√∂ft√∂ppnare',              sets: 1, reps: 10 },
            { name: 'Inchworm',                          sets: 1, reps: 6  },

            { name: 'Cirkeln ‚Äì 3 varv (40 sek arbete / 20 sek vila)', isSection: true },
            { name: 'Burpees',                           sets: 3, reps: 10 },
            { name: 'Jump squats',                       sets: 3, reps: 15 },
            { name: 'Push-ups',                          sets: 3, reps: 12 },
            { name: 'Mountain climbers (sek)',           sets: 3, reps: 30 },
            { name: 'Reverse lunges',                    sets: 3, reps: 12 },
            { name: 'H√∂ftlyft (golv)',                   sets: 3, reps: 20 },
            { name: 'Plankan (sek)',                     sets: 3, reps: 40 },
            { name: 'Ryska vridningar',                  sets: 3, reps: 20 },

            { name: 'Nedvarvning & stretching',          isSection: true },
            { name: 'H√∂ftstr√§ckning (sek)',              sets: 1, reps: 60 },
            { name: 'Hamstrings stretch (sek)',          sets: 1, reps: 60 },
            { name: 'Br√∂ststr√§ckning (sek)',             sets: 1, reps: 60 },
        ]
    },
];

const EXERCISE_IMAGES = {
    'Lutande hantelpress':  'https://privatetrainingonline.se/wp-content/uploads/2017/10/Lutande-bankpress-e1671284319441.jpg',
    'Rak hantelpress':      'https://privatetrainingonline.se/wp-content/uploads/2017/10/Hantelpress-Private-Training-Online-PTO-e1671284094884.jpg',
    'B√§nkpress':            'https://privatetrainingonline.se/wp-content/uploads/2016/01/bankpress-pto-e1628371128315.jpg',
    'Drag curl':            'https://privatetrainingonline.se/wp-content/uploads/2021/07/Skivstangscurl-e1637772602866.jpg',
    // Rygg & Biceps
    'Marklyft':             'https://privatetrainingonline.se/wp-content/uploads/2019/10/Marklyft.jpg',
    'Latsdrag':             'https://privatetrainingonline.se/wp-content/uploads/2014/10/AdobeStock_510223617.jpeg',
    'Sittande rodd':        'https://privatetrainingonline.se/wp-content/uploads/2014/10/Kabelrodd-Sittande-kabelrodd-PTO.jpg',
    'Hantelrodd':           'https://privatetrainingonline.se/wp-content/uploads/2019/07/Hantelrodd-Rygg√∂vning-hemma.jpeg',
    'Biceps curl (skivst√•ng)': 'https://privatetrainingonline.se/wp-content/uploads/2021/07/Skivstangscurl-e1637772602866.jpg',
    'Hammer curl':          'https://privatetrainingonline.se/wp-content/uploads/2018/02/hammercurls-pto-e1667299196848.jpg',
    'Pushdowns':            'https://privatetrainingonline.se/wp-content/uploads/2019/07/Pushdown-1-e1638635799836.jpg',
    'Pec deck':             'https://privatetrainingonline.se/wp-content/uploads/2017/10/Pec-Deck-Flyes-Brostovning-e1671284398930.jpg',
    'Br√∂stpress':           'https://privatetrainingonline.se/wp-content/uploads/2018/04/Brostpress-Private-Training-Online-e1671284232699.jpg',
};

let currentUser = null;
let currentType = null;
let currentProgramTitle = null;
let selectedActivity = null;

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('home-date').textContent = new Date().toLocaleDateString('sv-SE', {
    weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
});

const _savedUser = localStorage.getItem('traning_current_user');
if (_savedUser) {
    selectUser(_savedUser, true);
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0, 0);
}

function selectUser(name, silent = false) {
    currentUser = name;
    localStorage.setItem('traning_current_user', name);
    document.getElementById('home-greeting-name').textContent = `Hej, ${name}! üí™`;
    updateLastSessions();
    if (!silent) showScreen('screen-home');
    else {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('screen-home').classList.add('active');
    }
}

function switchUser() {
    currentUser = null;
    localStorage.removeItem('traning_current_user');
    showScreen('screen-user');
}

function goHome() {
    showScreen('screen-home');
    updateLastSessions();
    selectedActivity = null;
    currentProgramTitle = null;
}

function startWorkout(type) {
    currentType = type;
    currentProgramTitle = null;

    if (type === 'cardio') {
        document.querySelectorAll('.act-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('cardio-time').value = '';
        document.getElementById('cardio-kcal').value = '';
        showScreen('screen-cardio');
        return;
    }

    const data = WORKOUTS[type];
    const prev = getPrevious(type);

    document.getElementById('workout-title').textContent = data.title;
    document.getElementById('workout-badge').textContent = data.title;
    document.getElementById('workout-badge').style.background = data.color;
    document.getElementById('workout-date').textContent = new Date().toLocaleDateString('sv-SE');

    if (prev) {
        const d = new Date(prev.date).toLocaleDateString('sv-SE', { day: 'numeric', month: 'short' });
        document.getElementById('prev-session-info').textContent = `F√∂rra passet: ${d}`;
    } else {
        document.getElementById('prev-session-info').textContent = '';
    }

    const list = document.getElementById('exercises-list');
    list.innerHTML = '';

    data.exercises.forEach(name => {
        const prevEx = prev ? prev.exercises.find(e => e.name === name) : null;
        list.appendChild(buildExerciseCard(name, prevEx));
    });

    showScreen('screen-workout');
}

function showHistory() {
    const workouts = getStorage();
    const container = document.getElementById('history-list');

    if (workouts.length === 0) {
        container.innerHTML = '<div class="history-empty">Inga tr√§ningspass sparade √§n.</div>';
        showScreen('screen-history');
        return;
    }

    const sorted = [...workouts].reverse();
    container.innerHTML = sorted.map((w, i) => buildHistoryItem(w, i)).join('');
    showScreen('screen-history');
}

// ‚îÄ‚îÄ PROGRAMS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showPrograms() {
    const sections = {};
    PROGRAMS.forEach(p => {
        if (!sections[p.section]) sections[p.section] = [];
        sections[p.section].push(p);
    });

    let html = '';
    for (const [section, progs] of Object.entries(sections)) {
        html += `<div class="prog-section-label">${section}</div>`;
        progs.forEach(p => {
            html += `
            <div class="prog-card" style="--pc:${p.color}" onclick="startProgram('${p.id}')">
                <div class="prog-emoji">${p.emoji}</div>
                <div class="prog-info">
                    <div class="prog-name">${p.title}</div>
                    <div class="prog-sub">${p.subtitle}</div>
                    <div class="prog-meta">
                        <span class="prog-tag-level">${p.level}</span>
                        <span class="prog-tag">‚è± ${p.duration}</span>
                        <span class="prog-tag">${p.exercises.length} √∂vn.</span>
                    </div>
                </div>
                <div class="prog-arrow">‚Ä∫</div>
            </div>`;
        });
    }

    document.getElementById('programs-list').innerHTML = html;
    showScreen('screen-programs');
}

function startProgram(id) {
    const prog = PROGRAMS.find(p => p.id === id);
    if (!prog) return;

    currentType = prog.type;
    currentProgramTitle = prog.title;

    // Hitta f√∂rra g√•ngen just detta program k√∂rdes
    const prev = getStorage()
        .filter(w => w.title === prog.title)
        .sort((a, b) => new Date(b.date) - new Date(a.date))[0] || null;

    document.getElementById('workout-title').textContent = prog.title;
    document.getElementById('workout-badge').textContent = prog.subtitle;
    document.getElementById('workout-badge').style.background = prog.color;
    document.getElementById('workout-date').textContent = new Date().toLocaleDateString('sv-SE');

    if (prev) {
        const d = new Date(prev.date).toLocaleDateString('sv-SE', { day: 'numeric', month: 'short' });
        document.getElementById('prev-session-info').textContent = `F√∂rra passet: ${d}`;
    } else {
        document.getElementById('prev-session-info').textContent = '';
    }

    const list = document.getElementById('exercises-list');
    list.innerHTML = '';
    prog.exercises.forEach(ex => {
        if (ex.isSection) {
            const div = document.createElement('div');
            div.className = 'ex-section-head';
            div.textContent = ex.name;
            list.appendChild(div);
            return;
        }
        const prevEx = prev ? prev.exercises.find(e => e.name === ex.name) : null;
        list.appendChild(buildExerciseCard(ex.name, prevEx, ex));
    });

    showScreen('screen-workout');
}

// ‚îÄ‚îÄ EXERCISE CARDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildExerciseCard(name, prevEx, templateEx = null) {
    const div = document.createElement('div');
    div.className = 'ex-card';

    const imgUrl = EXERCISE_IMAGES[name];
    const imgHtml = imgUrl
        ? `<img class="ex-thumb" src="${imgUrl}" alt="${name}" onclick="openLightbox('${imgUrl}',event)" title="Klicka f√∂r att f√∂rstora">`
        : '';

    div.innerHTML = `
        <div class="ex-header">
            <span class="ex-name">${name}</span>
            ${imgHtml}
        </div>
        <table class="sets-table">
            <thead>
                <tr>
                    <th style="width:36px">Set</th>
                    <th>Vikt (kg)</th>
                    <th>Reps</th>
                    <th></th>
                </tr>
            </thead>
            <tbody class="sets-body"></tbody>
        </table>
        <button class="add-set-btn" onclick="addSet(this)">+ L√§gg till set</button>
    `;

    const prevSets = prevEx ? prevEx.sets : [];
    const setsToAdd = prevSets.length > 0 ? prevSets.length : (templateEx ? templateEx.sets : 3);
    const btn = div.querySelector('.add-set-btn');

    for (let i = 0; i < setsToAdd; i++) {
        const hasPrev = !!prevSets[i];
        addSet(btn, prevSets[i] || null, (!hasPrev && templateEx) ? templateEx : null);
    }

    return div;
}

function addSet(btn, prevSet = null, templateEx = null) {
    const tbody = btn.closest('.ex-card').querySelector('.sets-body');
    const num = tbody.querySelectorAll('.set-row').length + 1;

    const tr = document.createElement('tr');
    tr.className = 'set-row';

    const prevWeight  = prevSet ? prevSet.weight : '';
    const prevReps    = prevSet ? prevSet.reps : '';
    const suggestReps = templateEx ? templateEx.reps : '';

    const hintW = prevSet ? `<div class="prev-val">F√∂rra: ${prevWeight} kg</div>` : '';
    const hintR = prevSet
        ? `<div class="prev-val">F√∂rra: ${prevReps}</div>`
        : (templateEx ? `<div class="prev-val" style="color:#58a6ff">F√∂rslag: ${suggestReps} reps</div>` : '');

    tr.innerHTML = `
        <td class="set-num">${num}</td>
        <td>
            <input class="set-input" type="number" placeholder="${prevWeight || '0'}" min="0" step="0.5" inputmode="decimal">
            ${hintW}
        </td>
        <td>
            <input class="set-input" type="number" placeholder="${prevReps || suggestReps || '0'}" min="0" inputmode="numeric">
            ${hintR}
        </td>
        <td><button class="del-set" onclick="deleteSet(this)" title="Ta bort set">√ó</button></td>
    `;
    tbody.appendChild(tr);
}

function deleteSet(btn) {
    const tbody = btn.closest('.sets-body');
    btn.closest('.set-row').remove();
    tbody.querySelectorAll('.set-row').forEach((r, i) => {
        r.querySelector('.set-num').textContent = i + 1;
    });
}

// ‚îÄ‚îÄ CARDIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectActivity(el, activity) {
    document.querySelectorAll('.act-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    selectedActivity = activity;
}

// ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveWorkout() {
    const exercises = [];

    document.querySelectorAll('.ex-card').forEach(card => {
        const name = card.querySelector('.ex-name').textContent;
        const sets = [];

        card.querySelectorAll('.set-row').forEach(row => {
            const inputs = row.querySelectorAll('.set-input');
            const weight = inputs[0].value.trim();
            const reps   = inputs[1].value.trim();
            if (weight !== '' || reps !== '') {
                sets.push({ weight: weight || '0', reps: reps || '0' });
            }
        });

        if (sets.length > 0) exercises.push({ name, sets });
    });

    if (exercises.length === 0) {
        toast('Fyll i minst en √∂vning!', true); return;
    }

    saveToStorage({
        id: Date.now(),
        date: new Date().toISOString(),
        type: currentType,
        title: currentProgramTitle || (WORKOUTS[currentType] ? WORKOUTS[currentType].title : currentType),
        exercises
    });

    toast('Tr√§ningspass sparat!');
    setTimeout(goHome, 1600);
}

function saveCardio() {
    if (!selectedActivity) { toast('V√§lj en aktivitet!', true); return; }

    const time = document.getElementById('cardio-time').value.trim();
    const kcal = document.getElementById('cardio-kcal').value.trim();

    if (!time || !kcal) { toast('Fyll i tid och kalorier!', true); return; }

    const LABELS = { cykel: 'Cykel', promenad: 'Promenad', crosstrainer: 'Crosstrainer' };

    saveToStorage({
        id: Date.now(),
        date: new Date().toISOString(),
        type: 'cardio',
        title: 'Cardio',
        activity: selectedActivity,
        activityLabel: LABELS[selectedActivity],
        time: parseInt(time),
        kcal: parseInt(kcal)
    });

    toast('Cardio sparat!');
    setTimeout(goHome, 1600);
}

// ‚îÄ‚îÄ HISTORY VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildHistoryItem(w, i) {
    const date = new Date(w.date).toLocaleDateString('sv-SE', {
        weekday: 'short', day: 'numeric', month: 'short', year: 'numeric'
    });

    let bodyHtml = '';
    if (w.type === 'cardio') {
        const ICONS = { cykel: 'üö¥', promenad: 'üö∂', crosstrainer: 'üéø' };
        bodyHtml = `
            <div class="hist-cardio-info">
                ${ICONS[w.activity] || ''} <strong>${w.activityLabel}</strong> &nbsp;|&nbsp;
                <strong>${w.time}</strong> min &nbsp;|&nbsp;
                <strong>${w.kcal}</strong> kcal
            </div>`;
    } else {
        bodyHtml = (w.exercises || []).map(ex => `
            <div class="hist-ex">
                <div class="hist-ex-name">${ex.name}</div>
                <div class="hist-sets">
                    ${ex.sets.map((s, si) => `
                        <span class="hist-set-pill">${si+1}. ${s.weight} kg √ó ${s.reps}</span>
                    `).join('')}
                </div>
            </div>`).join('');
    }

    return `
        <div class="hist-item">
            <div class="hist-header" onclick="toggleHistory(this)">
                <span class="hist-title">${w.title}</span>
                <span class="hist-date">${date}</span>
                <span class="hist-chevron">‚ñº</span>
            </div>
            <div class="hist-body">${bodyHtml}</div>
        </div>`;
}

function toggleHistory(header) {
    header.classList.toggle('open');
    header.nextElementSibling.classList.toggle('open');
}

// ‚îÄ‚îÄ HOME CARD LAST SESSION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateLastSessions() {
    ['brost', 'rygg', 'axlar', 'cardio'].forEach(type => {
        const prev = getPrevious(type);
        const el = document.getElementById(`last-${type}`);
        if (prev) {
            const d = new Date(prev.date).toLocaleDateString('sv-SE', { day: 'numeric', month: 'short' });
            el.textContent = `Senast: ${d}`;
        } else {
            el.textContent = '';
        }
    });
}

// ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function storageKey() {
    return currentUser ? `traning_log_${currentUser.toLowerCase()}` : 'traning_log';
}

function getStorage() {
    return JSON.parse(localStorage.getItem(storageKey()) || '[]');
}

function saveToStorage(entry) {
    const data = getStorage();
    data.push(entry);
    localStorage.setItem(storageKey(), JSON.stringify(data));
}

function getPrevious(type) {
    return getStorage()
        .filter(w => w.type === type)
        .sort((a, b) => new Date(b.date) - new Date(a.date))[0] || null;
}

// ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openLightbox(src, e) {
    e.stopPropagation();
    document.getElementById('lightbox-img').src = src;
    document.getElementById('lightbox').classList.add('open');
}
function closeLightbox() {
    document.getElementById('lightbox').classList.remove('open');
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toast(msg, isError = false) {
    const el = document.getElementById('toast');
    el.textContent = msg;
    el.className = 'toast' + (isError ? ' error' : '') + ' show';
    setTimeout(() => el.classList.remove('show'), 2400);
}
</script>
</body>
</html>
